{% extends "base_admin.html" %}

{% block title %}Admin Sales Report | Kiddora{% endblock %}

{% block content %}
<style>
/* ===== DASHBOARD STYLING ===== */
.report-wrapper {
    padding: 24px;
    background: linear-gradient(135deg,#f4f7fb,#eef2f7);
    min-height: 100vh;
}
.report-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 24px;
}

/* ===== FILTERS ===== */
.filter-section {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 24px;
    align-items: center;
}
.filter-section label {
    font-weight: 500;
    margin-right: 8px;
}
.filter-section input, .filter-section select {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid #ccc;
}

/* ===== KPI CARDS ===== */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
    gap: 20px;
    margin-bottom: 40px;
}
.stat-card {
    background: #fff;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}
.stat-label {
    font-size: 13px;
    color: #777;
}
.stat-value {
    font-size: 26px;
    font-weight: 700;
    margin-top: 6px;
}
.bg-blue { background: linear-gradient(135deg,#dbeafe,#eff6ff); }
.bg-green { background: linear-gradient(135deg,#dcfce7,#f0fdf4); }

/* ===== CHART ===== */
.chart-card {
    background: #fff;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    margin-bottom: 40px;
}
.chart-card canvas {
    width: 100% !important;
    height: auto !important;
}
/* ===== TABLE ===== */
.table-wrapper {
    overflow-x: auto;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    padding: 12px 14px;
    font-size: 13px;
    border-bottom: 1px solid #eee;
    text-align: left;
}
th {
    background: #f8fafc;
    font-weight: 600;
}
.badge {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    color: #fff;
}
.badge-green { background:#16a34a; }
.badge-yellow { background:#f59e0b; }
.badge-red { background:#dc2626; }
</style>

<div class="report-wrapper">
    <h2 class="report-title">Sales Report</h2>

    <!-- ===== FILTERS ===== -->
    <form method="get" class="filter-section">
        <label for="type">Filter:</label>
        <select name="type" id="type" onchange="this.form.submit()">
            <option value="daily" {% if report_type|default:'' == "daily" %}selected{% endif %}>Daily</option>
            <option value="weekly" {% if report_type|default:'' == "weekly" %}selected{% endif %}>Weekly</option>
            <option value="yearly" {% if report_type|default:'' == "yearly" %}selected{% endif %}>Yearly</option>
        </select>

        <label for="start_date">Start Date:</label>
        <input type="date" id="start_date" name="start_date" value="{{ start_date|default:'' }}">

        <label for="end_date">End Date:</label>
        <input type="date" id="end_date" name="end_date" value="{{ end_date|default:'' }}">

        <button type="submit">Apply</button>
    </form>

    <!-- ===== KPI CARDS ===== -->
    <div class="stats-grid">
        <div class="stat-card bg-blue">
            <div class="stat-label">Total Orders</div>
            <div class="stat-value">{{ total_orders }}</div>
        </div>

        <div class="stat-card bg-green">
            <div class="stat-label">Total Sales</div>
            <div class="stat-value">₹ {{ total_sales }}</div>
        </div>
    </div>

    <!-- ===== REVENUE LINE CHART ===== -->
    <div class="chart-card" style="display: flex; justify-content: center; align-items: center;">
        <div style="width: 90%; max-width: 500px;">
            <h4 style="text-align: center;">Revenue Over Time</h4>
            <canvas id="revenueChart" style="height: 220px;"></canvas>
        </div>
    </div>
    <!-- ===== ORDERS TABLE ===== -->
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>User</th>
                    <th>Status</th>
                    <th>Payment</th>
                    <th>Final Amount</th>
                    <th>Order Date</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td>{{ order.order_id }}</td>
                    <td>{{ order.user.email }}</td>
                    <td>
                        {% if order.order_status == "DELIVERED" %}
                            <span class="badge badge-green">Delivered</span>
                        {% elif order.order_status == "CANCELLED" %}
                            <span class="badge badge-red">Cancelled</span>
                        {% else %}
                            <span class="badge badge-yellow">{{ order.order_status }}</span>
                        {% endif %}
                    </td>
                    <td>{{ order.payment_status }}</td>
                    <td>₹ {{ order.final_amount }}</td>
                    <td>{{ order.order_date|date:"d M Y H:i" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">No orders found for this period.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Prepare revenue data for chart
const revenueData = {
    labels: [
        {% for order in orders %}
            '{{ order.order_date|date:"d M" }}',
        {% endfor %}
    ],
    datasets: [{
        label: 'Revenue',
        data: [
            {% for order in orders %}
                {{ order.final_amount }},
            {% endfor %}
        ],
        fill: true,
        backgroundColor: 'rgba(59, 130, 246, 0.2)',
        borderColor: 'rgba(59, 130, 246, 1)',
        tension: 0.3
    }]
};

const revenueConfig = {
    type: 'line',
    data: revenueData,
    options: {
        responsive: true,
        plugins: {
            legend: { display: false },
            tooltip: { mode: 'index', intersect: false }
        },
        scales: {
            x: { title: { display: true, text: 'Date' } },
            y: { title: { display: true, text: 'Revenue (₹)' } }
        }
    }
};

new Chart(document.getElementById('revenueChart'), revenueConfig);
</script>
{% endblock %}
