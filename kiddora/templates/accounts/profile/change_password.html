{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Change Password | Kiddora</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
        }
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .auth-card {
            display: flex;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 900px;
            width: 100%;
        }
        .auth-left {
            flex: 1;
            background: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .auth-left img {
            max-width: 80%;
            max-height: 300px;
            border-radius: 12px;
            object-fit: cover;
        }
        .auth-center {
            flex: 1;
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .auth-center h2 {
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        .auth-center form {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        /* ‚îÄ‚îÄ MESSAGES ‚îÄ‚îÄ */
        .messages { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
        .message {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 14px; border-radius: 8px; font-size: 14px; font-weight: 500;
        }
        .message button {
            background: none; border: none; cursor: pointer;
            font-size: 18px; padding: 0 0 0 10px; color: inherit; opacity: 0.7;
        }
        .message button:hover { opacity: 1; }
        .message.success { background: #e6f9f0; color: #1a7a4a; border: 1px solid #a3e0c1; }
        .message.error   { background: #fdecea; color: #c0392b; border: 1px solid #f5a9a4; }

        /* ‚îÄ‚îÄ PASSWORD FIELD ‚îÄ‚îÄ */
        .password-field {
            position: relative;
        }
        .password-field input {
            width: 100%;
            padding: 12px 42px 12px 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 15px;
            transition: border-color 0.3s;
        }
        .password-field input:focus {
            border-color: #eb5ed6;
            outline: none;
        }
        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            font-size: 16px;
            user-select: none;
        }

        /* ‚îÄ‚îÄ STRENGTH BAR ‚îÄ‚îÄ */
        .strength-container {
            height: 6px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        #strengthBar {
            height: 100%;
            width: 0%;
            border-radius: 4px;
            transition: width 0.3s, background 0.3s;
        }
        #strengthText {
            font-size: 12px;
            color: #555;
            margin-top: 2px;
        }

        /* ‚îÄ‚îÄ PASSWORD RULES ‚îÄ‚îÄ */
        .password-rules {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 4px;
            font-size: 12px;
            color: #9ca3af;
        }
        .password-rules li::before { content: "‚úñ "; }
        .password-rules li.valid  { color: #16a34a; }
        .password-rules li.valid::before { content: "‚úî "; }

        /* ‚îÄ‚îÄ MATCH TEXT ‚îÄ‚îÄ */
        #matchText { font-size: 12px; margin-top: -6px; }

        /* ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ */
        .auth-center button[type="submit"] {
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: #eb5ed6;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .auth-center button[type="submit"]:hover { background: #b83583; }

        @media (max-width: 768px) {
            .auth-card { flex-direction: column; }
            .auth-left img { max-width: 60%; max-height: 200px; margin: 20px auto; }
        }
    </style>
</head>
<body>
<div class="auth-container">
    <div class="auth-card">

        <div class="auth-left">
            <img src="{% static 'images/gethnic_02.jpeg' %}" alt="Illustration">
        </div>

        <div class="auth-center">
            <h2>Change Password</h2>

            <!-- MESSAGES -->
            {% if messages %}
            <div class="messages" id="msgContainer">
                {% for message in messages %}
                <div class="message {{ message.tags }}">
                    <span>{{ message }}</span>
                    <button type="button" onclick="this.parentElement.remove()">√ó</button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <form method="post">
                {% csrf_token %}

                <!-- Current Password -->
                <div class="password-field">
                    <input type="password" id="current_password"
                            name="current_password" placeholder="Current Password" required>
                    <span class="toggle-password"
                            onclick="togglePassword('current_password', this)">üëÅ</span>
                </div>

                <!-- New Password -->
                <div class="password-field">
                    <input type="password" id="new_password" name="new_password" placeholder="New Password" required>
                    <span class="toggle-password" onclick="togglePassword('new_password', this)">üëÅ</span>
                </div>

                <!-- Strength bar -->
                <div class="strength-container">
                    <div id="strengthBar"></div>
                </div>
                <p id="strengthText"></p>

                <!-- Requirements -->
                <ul class="password-rules">
                    <li id="rule-length">At least 6 characters</li>
                    <li id="rule-uppercase">One uppercase letter</li>
                    <li id="rule-number">One number</li>
                    <li id="rule-special">One special character</li>
                </ul>

                <!-- Confirm Password -->
                <div class="password-field">
                    <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm New Password" required>
                    <span class="toggle-password" onclick="togglePassword('confirm_password', this)">üëÅ</span>
                </div>
                <p id="matchText"></p>

                <button type="submit">Change Password</button>
            </form>
        </div>

    </div>
</div>

<script>
    const newPasswordInput = document.getElementById("new_password");
    const confirmInput = document.getElementById("confirm_password");

    const strengthBar = document.getElementById("strengthBar");
    const strengthText = document.getElementById("strengthText");
    const ruleLength = document.getElementById("rule-length");
    const ruleUpper = document.getElementById("rule-uppercase");
    const ruleNumber = document.getElementById("rule-number");
    const ruleSpecial = document.getElementById("rule-special");
    const matchText = document.getElementById("matchText");

    /* ‚îÄ‚îÄ Strength checker ‚îÄ‚îÄ */
    newPasswordInput.addEventListener("input", () => {
        const val = newPasswordInput.value;
        let strength = 0;

        if (val.length >= 6) { ruleLength.classList.add("valid"); strength++; }
        else ruleLength.classList.remove("valid");

        if (/[A-Z]/.test(val)) { ruleUpper.classList.add("valid"); strength++; }
        else ruleUpper.classList.remove("valid");

        if (/[0-9]/.test(val)) { ruleNumber.classList.add("valid"); strength++; }
        else ruleNumber.classList.remove("valid");

        if (/[^A-Za-z0-9]/.test(val)) { ruleSpecial.classList.add("valid"); strength++; }
        else ruleSpecial.classList.remove("valid");

        strengthBar.style.width = (strength * 25) + "%";

        if (strength <= 1) {
            strengthBar.style.background = "#ef4444";
            strengthText.textContent = "Weak password";
            strengthText.style.color = "#ef4444";
        } else if (strength <= 3) {
            strengthBar.style.background = "#f59e0b";
            strengthText.textContent = "Medium password";
            strengthText.style.color = "#f59e0b";
        } else {
            strengthBar.style.background = "#16a34a";
            strengthText.textContent = "Strong password";
            strengthText.style.color = "#16a34a";
        }

        /* re-check match when new password changes */
        checkMatch();
    });

    /* ‚îÄ‚îÄ Match checker ‚îÄ‚îÄ */
    confirmInput.addEventListener("input", checkMatch);

    function checkMatch() {
        if (!confirmInput.value) { matchText.textContent = ""; return; }
        if (confirmInput.value === newPasswordInput.value) {
            matchText.textContent = "Passwords match ‚úî";
            matchText.style.color = "#16a34a";
        } else {
            matchText.textContent = "Passwords do not match";
            matchText.style.color = "#ef4444";
        }
    }

    /* ‚îÄ‚îÄ Toggle visibility ‚îÄ‚îÄ */
    function togglePassword(fieldId, icon) {
        const field = document.getElementById(fieldId);
        const isText = field.type === "text";
        field.type = isText ? "password" : "text";
        icon.textContent = isText ? "üëÅ" : "‚å£";
    }

    /* ‚îÄ‚îÄ Auto-dismiss messages after 15 seconds ‚îÄ‚îÄ */
    const msgContainer = document.getElementById("msgContainer");
    if (msgContainer) {
        setTimeout(() => {
            msgContainer.querySelectorAll(".message").forEach(msg => {
                msg.style.transition = "opacity 0.5s";
                msg.style.opacity = "0";
                setTimeout(() => msg.remove(), 500);
            });
        }, 15000);
    }
</script>
</body>
</html>