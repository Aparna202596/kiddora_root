{% extends "base_profile.html" %}

{% block content %}
<style>
    .filters {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 20px;
        background: #f9f9f9;
        padding: 15px;
        border-radius: 8px;
    }
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    .filter-group label {
        font-weight: bold;
        margin-bottom: 5px;
    }
    .filter-group input, .filter-group select {
        padding: 5px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }
    .product-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
    }
    .product-card {
        background: #fff;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        text-align: center;
        transition: transform 0.3s, box-shadow 0.3s;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .product-card h5 {
        margin: 10px 0 5px 0;
        font-size: 1.1rem;
    }
    .product-card p {
        margin: 3px 0;
    }
    .variants-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        justify-content: center;
        margin-top: 10px;
    }
    .variant-badge {
        padding: 3px 6px;
        border-radius: 5px;
        font-size: 0.8rem;
        color: #fff;
        cursor: default;
    }
    .variant-color { background-color: #00bcd4; }
    .variant-size { background-color: #00796b; }
    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
        gap: 10px;
    }
    .pagination a {
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 5px;
        text-decoration: none;
        color: #333;
    }
    .pagination a.active {
        background-color: #00bcd4;
        color: #fff;
        border-color: #00bcd4;
    }
</style>

<h2>
    {% if subcategory %}
        {{ subcategory.subcategory_name }}
    {% elif category %}
        {{ category.category_name }}
    {% else %}
        Products
    {% endif %}
</h2>

<form method="get" class="filters">
    <div class="filter-group">
        <label>Search</label>
        <input type="text" name="q" value="{{ request.GET.q }}">
    </div>
    <div class="filter-group">
        <label>Color</label>
        <select name="color" multiple>
            {% for color in filters.colors %}
                <option value="{{ color }}" {% if color in filters.selected_colors %}selected{% endif %}>{{ color }}</option>
            {% endfor %}
        </select>
    </div>
    
    <div class="filter-group">
        <label>Age Group</label>
        <select name="age_group" multiple>
            {% for age in filters.age_groups %}
                <option value="{{ age }}" {% if age in filters.selected_age_groups %}selected{% endif %}>{{ age }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="filter-group">
        <label>Price</label>
        <input type="number" name="min_price" placeholder="Min" value="{{ filters.min_price }}">
        <input type="number" name="max_price" placeholder="Max" value="{{ filters.max_price }}">
    </div>
    <div class="filter-group">
        <label>Sort By</label>
        <select name="sort_by">
            <option value="">Default</option>
            <option value="price_low" {% if filters.sort_by == "price_low" %}selected{% endif %}>Price: Low to High</option>
            <option value="price_high" {% if filters.sort_by == "price_high" %}selected{% endif %}>Price: High to Low</option>
            <option value="az" {% if filters.sort_by == "az" %}selected{% endif %}>A-Z</option>
            <option value="za" {% if filters.sort_by == "za" %}selected{% endif %}>Z-A</option>
            <option value="popularity" {% if filters.sort_by == "popularity" %}selected{% endif %}>Popularity</option>
        </select>
    </div>
    <div class="filter-group" style="align-self:flex-end">
        <button type="submit">Apply Filters</button>
    </div>
</form>

<div class="product-grid">
    {% for product in page_obj %}
        <div class="product-card">
            <h5>{{ product.product_name }}</h5>
            <p>Brand: {{ product.brand }}</p>
            <p>Price: â‚¹{{ product.final_price }}</p>
            
            <div class="variants-preview">
                {% for variant in product.variants.all %}
                    <span class="variant-badge variant-color" title="Color">{{ variant.color }}</span>
                    <span class="variant-badge variant-size" title="Size">{{ variant.size }}</span>
                {% endfor %}
            </div>

            <a href="{% url 'products:product_detail' product.id %}" style="margin-top:10px; display:inline-block;">View Details</a>
        </div>
    {% empty %}
        <p>No products found.</p>
    {% endfor %}
</div>

<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}">Prev</a>
    {% endif %}
    {% for num in page_obj.paginator.page_range %}
        <a href="?page={{ num }}" class="{% if page_obj.number == num %}active{% endif %}">{{ num }}</a>
    {% endfor %}
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Next</a>
    {% endif %}
</div>

{% endblock %}
